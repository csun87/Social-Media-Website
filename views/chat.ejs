<!DOCTYPE html>
<html>
<head>
  <title>Login</title>
  <link rel="stylesheet"
  href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style type="text/css">
  body {
    height: 100%;
  }

  html {
      height: 100%;
  }

  .left{
    height: 100%;
    width: 30%;
    background-color:rgb(54, 52, 52);
    height : 100%;
    color : rgb(167, 87, 87);
  }

  .right{
    height: 100%;
    width: 70%;
    background-color:rgb(61, 58, 58);
    height : 100%;
    color : white;
  }

  
  .card {
    padding-top: 0;  
    height: 87%;
    background-color: rgb(85, 82, 82);
  }

  .form-control {
      background-color: rgb(100, 96, 96);
      color: black;
      border-color: black;
      height:4%;
      max-width: 95%;
  }

  .panel {
    height : 5%;
    background-color: rgb(85, 82, 82);
  }

  .right-bubble {
    padding-left: 2%;
    width : 40%;
    height: 20%;
    background-color: rgb(63, 59, 59);
    color: rgb(232, 235, 235);
    font-size: 120%;
    content: left;
    
  }

  .flex {
    display: flex;
    flex-direction: row;
  }

  .r {
    color: blue;
  }



</style>

</head>

<body>


  <div class="col-lg-6 col-sm-12 left">
    
  </div>

  <div id = "chat-right" class="col-lg-6 col-sm-12 right">
    <div class = "panel">
    </div>
    <div class = "card">
        <div class = "card-body">
          <ul class = "mesList" id = "messages">
            First
          </ul>

          
            
        </div>
    </div>
    <form id="form" action="" class="flex">
      <input id = "input" autocomplete="off" type="text" class = "form-control" placeholder="Type a message..."> </br> 
      <button type="button" class="btn btn-sm btn-secondary btn-lg">Send</button>
    </form>
  </div>



<script src="/socket.io/socket.io.js" type="text/javascript"></script>
<script>
  var socket = io();
  
  //change the socket io stock code
  var messages = document.getElementById('messages');
  var form = document.getElementById('form');
  var input = document.getElementById('input');
  var messageList = []


  socket.on('chat message', function(msg) {
    console.log('pls')
    var item = document.createElement('li');
    item.textContent = msg;
    item.className = "r";
    messages.appendChild(item);
    messageList.push(item)
    console.log(messageList)
    window.scrollTo(0, document.body.scrollHeight);
  });

  socket.on('prev_messages', function(msg) {
    console.log(msg)
    msg[0].Items.forEach(x => {
      var item = document.createElement('li');
      if(x.author.S == msg[1].user) {
        item.className = "r";
      }
      item.textContent = x.message.S;
      messages.appendChild(item);
      messageList.push(item)
      window.scrollTo(0, document.body.scrollHeight);
    })
    
  });

  socket.on('refr', function(msg) {
    var newMessage = true;
    console.log(msg)
    msg[0].Items.forEach(x => {

      var item = document.createElement('li');
      if(x.author.S == msg[1].user) {
        item.className = "r";
      }   
      item.textContent = x.message.S;

      for (var i = 0; i < messageList.length; i++) {
        if(messageList[i].textContent == item.textContent && messageList[i].className == item.className) {
          newMessage = false;
        }
      }
      if (newMessage) {
        console.log("new message")
        messages.appendChild(item);
        messageList.push(item);
      }
      newMessage = true;  
    })
    
  });


  form.addEventListener('submit', function(e) {
    console.log("werg")
    e.preventDefault();
    if (input.value) {
      console.log("werb")
      socket.emit('test', input.value);
      input.value = '';
    }
  });
  

  setInterval(function() {
    console.log("refresh")
    socket.emit('refresh', 0);
  }, 2000);



  
</script>
		   
</body>
</html>
